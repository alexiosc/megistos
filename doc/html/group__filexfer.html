<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Megistos API: File transfers</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>File transfers</h1>Like every self-respecting BBS worth the coffee it was coded on, Megistos allows users to transfer files from and to the system.  
<a href="#_details">More...</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Modules</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>group &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__FXM__flags.html">File transfer modes (FXM_x)</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">File transfer modes. <br><br></td></tr>

<p>
<tr><td colspan=2><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>struct &nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="structxfer__item__t.html">xfer_item_t</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">File transfer item structure.  <a href="structxfer__item__t.html#_details">More...</a><br><br></td></tr>
<tr><td colspan=2><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__filexfer.html#ga7">RCS_VER</a>&nbsp;&nbsp;&nbsp;"$Id: filexfer.h,v 1.4 2003/09/27 20:30:34 alexios Exp $"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__filexfer.html#ga8">XFERLIST</a>&nbsp;&nbsp;&nbsp;TMPDIR"/xfer%05d"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__filexfer.html#ga9">TAGLIST</a>&nbsp;&nbsp;&nbsp;TMPDIR"/tag%s%s"</td></tr>

<tr><td class="memItemLeft" nowrap align=right valign=top>#define&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__filexfer.html#ga10">XFER_ITEM_MAGIC</a>&nbsp;&nbsp;&nbsp;"Mxfi" /**&lt; Value of <a class="el" href="structxfer__item__t.html#o0">xfer_item_t::magic</a> */</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Value of <a class="el" href="structxfer__item__t.html#o0">xfer_item_t::magic</a>.  <a href="#ga10"></a><br><br></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__filexfer.html#ga0">xfer_setaudit</a> (<a class="el" href="config_8h.html#a159">uint32</a> fok, char *sok, char *dok, <a class="el" href="config_8h.html#a159">uint32</a> ffail, char *sfail, char *dfail)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Customise post-transfer auditing.  <a href="#ga0"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__filexfer.html#ga1">xfer_setcmd</a> (char *cmdok, char *cmdfail)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Customise post-transfer commands.  <a href="#ga1"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__filexfer.html#ga2">xfer_add</a> (char mode, char *file, char *description, <a class="el" href="config_8h.html#a155">int32</a> refund, <a class="el" href="config_8h.html#a155">int32</a> credspermin)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add a file to the transfer queue.  <a href="#ga2"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__filexfer.html#ga3">xfer_addwild</a> (char mode, char *filespec, char *description, <a class="el" href="config_8h.html#a155">int32</a> refund, <a class="el" href="config_8h.html#a155">int32</a> credspermin)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add a number of files to the transfer queue.  <a href="#ga3"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__filexfer.html#ga4">xfer_run</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Begin the file transfer.  <a href="#ga4"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__filexfer.html#ga5">xfer_kill_list</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Empties the transfer queue.  <a href="#ga5"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__filexfer.html#ga6">xfer_kill_taglist</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Clears the tagged file list.  <a href="#ga6"></a><br><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Like every self-respecting BBS worth the coffee it was coded on, Megistos allows users to transfer files from and to the system. 
<p>
The file transfer subsystem is a pretty complex thing in itself and coded as a separate module. Thankfully, its API is disproportionately easy to use.<p>
This interface provides functions to add files to the user's upload or download queue, call the file transfer module, and customise its actions before and after the file transfer itself.<p>
The user has the option to download files immediately when they are presented to them, or to tag them for a later transfer. Your code should be aware of this because the successful exit of the file transfer module does <em>not</em> guarantee the file was actually downloaded by the user. Files created specifically for the user should thus be kept around until the user exits, at which point they can either be deleted by the module's logout/hangup handler, or kept for a while and deleted during the nightly cleanup.<p>
Alternatively, they may be marked as <em>transient</em> files using the <a class="el" href="group__FXM__flags.html#ga2">FXM_TRANSIENT</a> flag, and the user will be forced to download the file on the spot.<p>
User-defined audit messages can be logged on successful or unsuccessful termination of the file transfer.<p>
A file transfer session may upload or download files (but not both simultaneously).<p>
Custom charges may be set for downloading a file. Refunds are handled transparently.<p>
Custom shell commands may be executed on (un)successful termination of a download. <hr><h2>Define Documentation</h2>
<a class="anchor" name="ga7" doxytag="filexfer.h::RCS_VER" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define RCS_VER&nbsp;&nbsp;&nbsp;"$Id: filexfer.h,v 1.4 2003/09/27 20:30:34 alexios Exp $"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="filexfer_8h-source.html#l00110">110</a> of file <a class="el" href="filexfer_8h-source.html">filexfer.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="ga9" doxytag="filexfer.h::TAGLIST" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define TAGLIST&nbsp;&nbsp;&nbsp;TMPDIR"/tag%s%s"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="filexfer_8h-source.html#l00119">119</a> of file <a class="el" href="filexfer_8h-source.html">filexfer.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="ga10" doxytag="filexfer.h::XFER_ITEM_MAGIC" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define XFER_ITEM_MAGIC&nbsp;&nbsp;&nbsp;"Mxfi" /**&lt; Value of <a class="el" href="structxfer__item__t.html#o0">xfer_item_t::magic</a> */          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Value of <a class="el" href="structxfer__item__t.html#o0">xfer_item_t::magic</a>. 
<p>

<p>
Definition at line <a class="el" href="filexfer_8h-source.html#l00163">163</a> of file <a class="el" href="filexfer_8h-source.html">filexfer.h</a>.    </td>
  </tr>
</table>
<a class="anchor" name="ga8" doxytag="filexfer.h::XFERLIST" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> #define XFERLIST&nbsp;&nbsp;&nbsp;TMPDIR"/xfer%05d"          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>

<p>
Definition at line <a class="el" href="filexfer_8h-source.html#l00118">118</a> of file <a class="el" href="filexfer_8h-source.html">filexfer.h</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="ga2" doxytag="filexfer.h::xfer_add" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int xfer_add           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char&nbsp;</td>
          <td class="mdname" nowrap> <em>mode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>file</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>description</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="config_8h.html#a155">int32</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>refund</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="config_8h.html#a155">int32</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>credspermin</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Add a file to the transfer queue. 
<p>
This function adds a file for transfer. A number of arguments are required:<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>mode</em>&nbsp;</td><td>one of the <code>FXM_x</code> file transfer modes.</td></tr>
    <tr><td></td><td valign=top><em>file</em>&nbsp;</td><td>the full pathname to a file. If this file is about to be uploaded (user to BBS), this is the recommended (but <em>NOT</em> certain) name of the file.</td></tr>
    <tr><td></td><td valign=top><em>description</em>&nbsp;</td><td>a short (50 bytes including terminating null) description of the file.</td></tr>
    <tr><td></td><td valign=top><em>refund</em>&nbsp;</td><td>how many credits we will refund the user for canceling this transfer.</td></tr>
    <tr><td></td><td valign=top><em>credspermin</em>&nbsp;</td><td>credit consumption rate during the file transfer. <em> This quantity is times 100</em>. To specify consumption of 2.5 credits per minute, use 250. Specify 0 for no time-based credit charges, or -1 for the current per-minute charge, whatever that is.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>This function returns 0 if the file is being downloaded and <code>fstat()</code> could not access <code>file</code>, or (regardless of file direction) if the file transfer queue for this user could not be appended to.</dd></dl>
<dl compact><dt><b>See also:</b></dt><dd><a class="el" href="group__filexfer.html#ga0">xfer_setaudit()</a>, <a class="el" href="group__filexfer.html#ga1">xfer_setcmd()</a>, <a class="el" href="group__filexfer.html#ga3">xfer_addwild()</a> </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="ga3" doxytag="filexfer.h::xfer_addwild" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int xfer_addwild           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char&nbsp;</td>
          <td class="mdname" nowrap> <em>mode</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>filespec</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>description</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="config_8h.html#a155">int32</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>refund</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="config_8h.html#a155">int32</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>credspermin</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Add a number of files to the transfer queue. 
<p>
This function adds zero or more files for transfer, based on a UNIX glob (filename with wildcards). This function is very similar to <code><a class="el" href="group__filexfer.html#ga2">xfer_add()</a></code>, but is more useful for downloads than uploads. Be warned, this function executes the <code>find</code> UNIX command to expand the glob. This implies a relative latency in executing and a serious lack of security.<p>
<dl compact><dt><b>Warning:</b></dt><dd>DO NOT CALL THIS FUNCTION WITH USER-SUPPLIED VALUES FOR THE <code>filespec</code> ARGUMENT.</dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>mode</em>&nbsp;</td><td>one of the <code>FXM_x</code> file transfer modes.</td></tr>
    <tr><td></td><td valign=top><em>filespec</em>&nbsp;</td><td>a glob that will be expanded in order to get the filenames. Anything that you could give to, say, <code>ls</code> is acceptable. Incorrectly formed globs will simply yield no filenames.</td></tr>
    <tr><td></td><td valign=top><em>description</em>&nbsp;</td><td>a short (50 bytes including terminating null) description of the files. The description will be common to all files.</td></tr>
    <tr><td></td><td valign=top><em>refund</em>&nbsp;</td><td>how many credits we will refund the user for canceling <em> each file</em> in this transfer.</td></tr>
    <tr><td></td><td valign=top><em>credspermin</em>&nbsp;</td><td>credit consumption rate during the file transfer. <em>This quantity is times 100</em>. To specify consumption of 2.5 credits per minute, use 250. Specify 0 for no time-based credit charges, or -1 for the current per-minute charge, whatever that is.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>This function returns 0 if the <code>find</code> command could not run to expand the glob, or if the file transfer queue for this user could not be appended to.</dd></dl>
<dl compact><dt><b>See also:</b></dt><dd><a class="el" href="group__filexfer.html#ga0">xfer_setaudit()</a>, <a class="el" href="group__filexfer.html#ga1">xfer_setcmd()</a>, <a class="el" href="group__filexfer.html#ga2">xfer_add()</a> </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="ga5" doxytag="filexfer.h::xfer_kill_list" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int xfer_kill_list           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Empties the transfer queue. 
<p>
Run this function to delete the user's transfer queue. Do not use this function unless you really, really know what you're doing. The transfer queue may contain file transfer requests other than your own module's.<p>
<dl compact><dt><b>Returns:</b></dt><dd>The same as the <code>unlink()</code> system call: zero if everything went well, -1 if not (in which case, <code>errno</code> will be set accordingly). </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="ga6" doxytag="filexfer.h::xfer_kill_taglist" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int xfer_kill_taglist           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Clears the tagged file list. 
<p>
Run this function to delete the user's tagged file list. Do not use this function unless you really, really know what you're doing. The transfer queue may contain postponed file transfer requests other than your own module's.<p>
<dl compact><dt><b>Returns:</b></dt><dd>The same as the <code>unlink()</code> system call: zero if everything went well, -1 if not (in which case, <code>errno</code> will be set accordingly). </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="ga4" doxytag="filexfer.h::xfer_run" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int xfer_run           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Begin the file transfer. 
<p>
This very simple function begins the file transfer. It should be run after one of more files have been added to the transfer queue, or if you can guarantee that the queue contains files. The file transfer subsystem will exit gracefully if the list is empty, but not before notifying the user of this. You don't want to appear stupid in front of your users, do you?<p>
<dl compact><dt><b>Returns:</b></dt><dd>The UNIX exit code of the file transfer module. This is the same as that returned by the C <code>system()</code> function. A value of 0 means that the subsystem has exited normally. Anything else represents an abnormal termination. </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="ga0" doxytag="filexfer.h::xfer_setaudit" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void xfer_setaudit           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="config_8h.html#a159">uint32</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>fok</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>sok</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>dok</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="config_8h.html#a159">uint32</a>&nbsp;</td>
          <td class="mdname" nowrap> <em>ffail</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>sfail</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>dfail</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Customise post-transfer auditing. 
<p>
This function should be executed before adding a file to the transfer list. It will affect any subsequent additions to the list, but not existing items.<p>
The arguments of this function are ordered in such a way as to allow the use of the <a class="el" href="group__audit.html#ga124">AUDIT</a> macro, as used in normal auditing. If any of the string arguments is <code>NULL</code>, the corresponding logging action will not be performed. This way you can add logging for, say, failed transfers, but not successful ones.<p>
Please note that, unlike <a class="el" href="group__audit.html#ga0">audit()</a>, you <em>cannot</em> provide arguments to the detailed information format strings (<code>dok</code> and { dfail}). These must always contain the following two format specifiers, <em>in order</em>:<p>
<ul>
<li>A string (<code>%s</code>) specifier. This will be substituted by the user ID of the user performing the transfer.</li></ul>
<p>
<ul>
<li>A string (<code>%s</code>) specifier to be substituted by the transfer filename.</li></ul>
<p>
It might be nice to use (loosely) the Major shorthand for successful and failed file transfers: `<code>user &lt;- file</code>' for successful downloads, `<code> user (- file</code>' (think of a blunt arrow) for failed downloads. For uploads, the arrow points to the right. Of course, you can always add any required information to this.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>fok</em>&nbsp;</td><td>audit type and severity for successful transfer logging. </td></tr>
    <tr><td></td><td valign=top><em>sok</em>&nbsp;</td><td>audit summary for successful transfers. </td></tr>
    <tr><td></td><td valign=top><em>dok</em>&nbsp;</td><td>audit detailed text template for successful transfers.</td></tr>
    <tr><td></td><td valign=top><em>ffail</em>&nbsp;</td><td>audit type and severity for failed transfer logging. </td></tr>
    <tr><td></td><td valign=top><em>sfail</em>&nbsp;</td><td>audit summary for failed transfers. </td></tr>
    <tr><td></td><td valign=top><em>dfail</em>&nbsp;</td><td>audit detailed text template for failed transfers.</td></tr>
  </table>
</dl>
<dl compact><dt><b>See also:</b></dt><dd><a class="el" href="group__audit.html#ga124">AUDIT</a>, <a class="el" href="group__filexfer.html#ga2">xfer_add()</a>, <a class="el" href="group__filexfer.html#ga3">xfer_addwild()</a>. </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="ga1" doxytag="filexfer.h::xfer_setcmd" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void xfer_setcmd           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname" nowrap> <em>cmdok</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>cmdfail</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Customise post-transfer commands. 
<p>
This function sets a pair of commands to be executed after a successful or failed download respectively. Please uses this responsibly and with an eye open for security risks. The command will, of course, be executed by the <code>bbs</code> user, but be wary of untested <code> rm</code>s, or commands with any components that may be filled in by users.<p>
To disable a command execution, pass a <code>NULL</code> to the corresponding argument. If you use this function, you should call <code>xfer_setcmd(NULL,NULL)</code> immediately after calling <a class="el" href="group__filexfer.html#ga4">xfer_run()</a>.<p>
<dl compact><dt><b>Warning:</b></dt><dd>This will affect any subsequent additions to the transfer queue, but not existing entries. Use this function before adding files to the queue and <em>REMEMBER TO RESET IT AFTERWARDS</em> if you'll be transferring other files from within the current module.</dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>cmdok</em>&nbsp;</td><td>a command to execute if the transfer succeeds. </td></tr>
    <tr><td></td><td valign=top><em>cmdfail</em>&nbsp;</td><td>a command to execute if the transfer fails.</td></tr>
  </table>
</dl>
<dl compact><dt><b>See also:</b></dt><dd><a class="el" href="group__filexfer.html#ga2">xfer_add()</a>, <a class="el" href="group__filexfer.html#ga3">xfer_addwild()</a>. </dd></dl>
    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Thu Jul 15 16:04:03 2004 for Megistos API by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
