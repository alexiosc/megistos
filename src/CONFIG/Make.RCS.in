.PHONY:		ci co

RCSDIR =	RCS
CIFLAGS =	-w$(RCSAUTHOR)		# Flags for ci(1)
COFLAGS =	-l			# Flags for co(1)
RCSFLAGS =	-U			# Flags for rcs(1)
FIRSTUNSTABLE =	0.1			# First unstable version
FIRSTSTABLE =	1.0			# First stable version

RCSFILES =	$(shell echo $(RCSDIR)/*.[ch],v)
RAWFILES =	$(subst RCS/,,$(RCSFILES:,v=))


# This expects RCSAUTHOR to be set, otherwise it uses whoami(1) to
# find out.

ifeq (.$(RCSAUTHOR),.)
    RCSAUTHOR =	`whoami`
endif


# Check if file .stable exists. If it does, this is a Stable part of
# the system. Check it in as such.

ci:		
		@echo Checking in files in directory $$PWD, author is $(RCSAUTHOR)
		@if [ -r .stable ]; then \
			echo Code is STABLE.; \
			echo 'Checking in *NEW* files first.';\
			$(CI) $(CIFLAGS) -sStab -i$(FIRSTSTABLE) *.[ch]||true; \
			echo Re-checking in files with previous RCS versions.;\
			$(CI) $(CIFLAGS) -sStab $(RAWFILES)||true;\
		else \
			echo 'Checking in *NEW* files first.';\
			$(CI) $(CIFLAGS) -i$(FIRSTSTABLE) *.[ch]||true; \
			echo Re-checking in files with previous RCS versions.;\
			$(CI) $(CIFLAGS) $(RAWFILES)||true;\
		fi
		$(RCS) $(RCSFLAGS) RCS/* || true

co:
		@echo Checking out into $$PWD, author is $(RCSAUTHOR)
		$(CO) $(COFLAGS) $(RAWFILES) || true
