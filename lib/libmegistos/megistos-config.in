#!/bin/sh

 #############################################################################
 ##                                                                         ##
 ##  FILE:     megistos-config                                              ##
 ##  AUTHORS:  Alexios                                                      ##
 ##  PURPOSE:  Yield information about a Megistos BBS build.                ##
 ##  NOTES:                                                                 ##
 ##  LEGALESE:                                                              ##
 ##                                                                         ##
 ##  This program is free software; you  can redistribute it and/or modify  ##
 ##  it under the terms of the GNU  General Public License as published by  ##
 ##  the Free Software Foundation; either version 2 of the License, or (at  ##
 ##  your option) any later version.                                        ##
 ##                                                                         ##
 ##  This program is distributed  in the hope  that it will be useful, but  ##
 ##  WITHOUT    ANY WARRANTY;   without  even  the    implied warranty  of  ##
 ##  MERCHANTABILITY or  FITNESS FOR  A PARTICULAR  PURPOSE.   See the GNU  ##
 ##  General Public License for more details.                               ##
 ##                                                                         ##
 ##  You  should have received a copy   of the GNU  General Public License  ##
 ##  along with    this program;  if   not, write  to  the   Free Software  ##
 ##  Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.              ##
 #############################################################################

# $Id$
#
# $Log$
# Revision 1.2  2003/12/19 13:25:56  alexios
# Significant update in functionality to accommodate new build
# structure.
#
# Revision 1.1  2003/08/15 20:09:51  alexios
# Initial revision.
#

# Based heavily on xmms-config, whose blurb reads:
#
# Written 15 December 1999 by Ben Gertzfield <che@debian.org>
# Based *HEAVILY* on gtk-config from the GTK+ library package.
#
# This work is released under the GNU GPL, version 2 or later.

prefix="@prefix@"
exec_prefix="@exec_prefix@"
exec_prefix_set=no
data_dir="@PKGDATADIR@"
version="@VERSION@"
includedir="@PKGINCLUDEDIR@"
libdir="@PKGLIBDIR@"
builddir=`echo @abs_top_builddir@ | sed 's/libmegistos\/..\/*//'`
srcdir=`echo @abs_top_srcdir@ | sed 's/libmegistos\/..\/*//'`
instancedir="@INSTANCEDIR@"
virgininstance="@VIRGININSTANCE@"
virginsrc="$builddir/@VIRGINDIR@"

usage()
{
    cat <<EOF
Usage: $0 [OPTIONS]
Options:
    [--prefix[=DIR]]
    [--exec-prefix[=DIR]]
    [--version]
    [--ldflags]
    [--cflags]
    [--lib-dir]
    [--data-dir]
    [--instance-dir]
    [--virgin-dir]
    [--build-dir]
    [--source-dir]
    [--include-dir]

Version:                $version
Prefix:                 $prefix
Exec prefix:            $exec_prefix
Library directory:      $libdir
Build directory:        $builddir
Source directory:       $srcdir
Include directory:      $includedir
Instance directory:     $instancedir
Virgin instance source: $virginsrc
Virgin instance:        $virgininstance

EOF
    exit $1
}

if test $# -eq 0; then
    usage 1 1>&2
fi


while test $# -gt 0; do
    case "$1" in
	-*=*) optarg=`echo "$1" | sed 's/[-_a-zA-Z0-9]*=//'` ;;
	*) optarg= ;;
    esac

    case $1 in
	--prefix=*)
	    prefix=$optarg
	    if test $exec_prefix_set = no ; then
		exec_prefix=$optarg
	    fi
	    ;;

	--prefix)
	    echo_prefix=yes
	    ;;

	--exec-prefix=*)
	    exec_prefix=$optarg
	    exec_prefix_set=yes
	    ;;

	--exec-prefix)
	    echo_exec_prefix=yes
	    ;;

	--version)
	    echo $version
	    ;;

	--cflags)
	    echo_cflags=yes
	    ;;

	--ldflags)
	    echo_ldflags=yes
	    ;;

	--data-dir)
	    echo_data_dir=yes
	    ;;

	--lib-dir)
	    echo_lib_dir=yes
	    ;;

	--instance-dir)
	    echo_instance_dir=yes
	    ;;

	--virgin-dir)
	    echo_virgin_dir=yes
	    ;;

	--build-dir)
	    echo_build_dir=yes
	    ;;

	--source-dir)
	    echo_source_dir=yes
	    ;;

	--include-dir)
	    echo_include_dir=yes
	    ;;

	--header)
	    echo_header=yes
	    ;;

	*)
	    usage 1 1>&2
	    ;;
    esac
  shift
done

if test "$echo_prefix" = "yes"; then
    echo $prefix
fi

if test "$echo_exec_prefix" = "yes"; then
    echo $exec_prefix
fi

if test "$includedir" != "/usr/include"; then
    cflags="-I$includedir -I$includedir/mbk @CFLAGS@"
else
    cflags="-I$includedir -I$includedir/mbk @CFLAGS@"
fi

if test "$lib_dir" != "/usr/lib"; then
    ldflags="-L$lib_dir -l@BASENAME@"
else
    ldflags="-l@BASENAME@"
fi

if test "$echo_cflags" = "yes"; then
    echo $cflags
fi

if test "$echo_ldflags" = "yes"; then
    echo $ldflags
fi

if test "$echo_data_dir" = "yes"; then
    echo $data_dir
fi

if test "$echo_lib_dir" = "yes"; then
    echo $libdir
fi

if test "$echo_instance_dir" = "yes"; then
    echo $instancedir
fi

if test "$echo_virgin_dir" = "yes"; then
    echo $virgininstance
fi

if test "$echo_build_dir" = "yes"; then
    echo $builddir
fi

if test "$echo_source_dir" = "yes"; then
    echo $srcdir
fi

if test "$echo_include_dir" = "yes"; then
    echo $includedir
fi

if test "$echo_header" = "yes"; then
    cat <<EOF
#define __PREFIX       "$prefix"
#define __EXECPREFIX   "$exec_prefix"
#define __VIRGINDIR    "$virgininstance"
#define __LIBDIR       "$libdir"
#define __DATADIR      "$data_dir"
#define __INSTANCEDIR  "$instancedir"
#define __INCLUDEDIR   "$includedir"
EOF
fi
