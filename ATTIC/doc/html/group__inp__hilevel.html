<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Megistos API: High-Level user-interacting input/validation</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>High-Level user-interacting input/validation<br>
<small>
[<a class="el" href="group__input.html">Reading data from the user</a>]</small>
</h1>Very high-level input functionality.  
<a href="#_details">More...</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__inp__hilevel.html#ga0">get_number</a> (int *num, int msg, int min, int max, int err, int def, int defval)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get an integer within certain limits.  <a href="#ga0"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__inp__hilevel.html#ga1">get_bool</a> (int *retbool, int msg, int err, int def, int defval)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get a boolean (yes or no) answer.  <a href="#ga1"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__inp__hilevel.html#ga2">get_userid</a> (char *uid, int msg, int err, int def, char *defval, int online)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Get and validate a user ID.  <a href="#ga2"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__inp__hilevel.html#ga3">get_menu</a> (char *option, int showmenu, int lmenu, int smenu, int err, char *opts, int def, int defval)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Validate input for a simple menu.  <a href="#ga3"></a><br><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Very high-level input functionality. 
<p>
This group of functions implements most of the input functionality needed by Megistos modules. It is <em>strongly</em> recommended that you use them, as they keep the user interface consistent (and if the interface changes, the behaviour of your module will change without you having to rewrite code).<p>
These functions present the user with prompts, read and validate input, offer and handle defaults, deal with concatenated commands, and produce error messages and help. Unfortunately, they need quite a few arguments. Sorry!<p>
Fortunately, the calling interface is very similar for all these functions. Don't be scared by the long documentation, it's mostly cut and paste stuff!<p>
You can use them as examples to code your own, specialised functions in your modules. However, please only do so if the functionality isn't provided here.<p>
There are some common points in all these functions.<p>
<ul>
<li>Prompts are provided to the user. Any prompts may be zero, in which case the user is not prompted at all. This may be inelegant in some cases.</li></ul>
<p>
<ul>
<li>Defaults are handled by providing a prompt number and default value. The prompt indexed by the prompt number displays the default value using a suitable format specifier. If the prompt number is zero, it is not printed (it is thus expected that the first prompt printed will tell the user what the default value is). If the default value is zero or NULL (depending on the function), the default facility is disabled and the user <em>must</em> enter a value. This is done so as to allow BBS prompts the flexibility to be issued with and without defaults with minimum hassle.</li></ul>
<p>
<ul>
<li>Reprompting after injected messages (see injoth()) is handled elegantly.</li></ul>
<p>
<ul>
<li>Help is available to the user by providing a help prompt index. If it is zero, no help will be available. In the case of menu handling, asking for help redisplays the long version of a menu.</li></ul>
<p>
<ul>
<li>Optionally, the caller can set #INP_HELP. In this case, if <code>?</code> is specified by the user, the function exits returning -1. The caller can then handle the help request themselves, e.g. by generating and printing a long list of possible values the user may enter.</li></ul>
<p>
<ul>
<li>The user may exit at any time by entering 'X'. In this case, these functions return 0 and do <em>not</em> return any input. </li></ul>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="ga1" doxytag="input.h::get_bool" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int get_bool           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int *&nbsp;</td>
          <td class="mdname" nowrap> <em>retbool</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>err</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>def</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>defval</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get a boolean (yes or no) answer. 
<p>
Works just like getnumber(). Prompts <code>msg</code>, asks for a { Y/N answer, prompts <code>err</code> if there was a bad response, optionally prompts <code>def</code> with a default value of <code>defval:</code> 0 for no or 1 for yes.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>retbool</em>&nbsp;</td><td>pointer to an <code>int</code>. This is written to if a valid (or default) answer is provided. The variable will be set to 1 if `yes' was chosen, and to 0 if the answer was `no'.</td></tr>
    <tr><td></td><td valign=top><em>msg</em>&nbsp;</td><td>is the short prompt number to display. This should give the user a brief idea of what is expected of them. This prompt should belong to the current message block. It will not be displayed if the value is zero, but please don't do this as it makes things look inelegant.</td></tr>
    <tr><td></td><td valign=top><em>err</em>&nbsp;</td><td>the error prompt to display. Specify zero to disable error printing.</td></tr>
    <tr><td></td><td valign=top><em>def</em>&nbsp;</td><td>is the user prompt used when defaults are used (which must belong to the current prompt block). This is usually a short string added to the short menu prompt, and looks like `<code>(Enter=%c)</code>' or `<code>[%d]</code>'. The format specifier gets either `Y' or `N', depending on the value of <code>defval</code>. Use a zero to disable printing of <code>defval</code> where, for instance, the default value is printed by <code>msg</code>.</td></tr>
    <tr><td></td><td valign=top><em>defval</em>&nbsp;</td><td>is the default value for when the user presses <code>Enter</code>. Non-zero values stand for yes; zero is no.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Zero if X entered; one is returned if the answer was valid, in which case it is stored in <code>retbool</code> (1 for `yes', 0 for `no'). A value of <code>-1</code> implies that <a class="el" href="group__INF__flags.html#ga0">INF_HELP</a> was set and the user entered `?'. </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="ga3" doxytag="input.h::get_menu" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int get_menu           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname" nowrap> <em>option</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>showmenu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>lmenu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>smenu</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>err</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>opts</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>def</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>defval</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Validate input for a simple menu. 
<p>
Displays a long menu (<code>lmenu</code>) once per session (if <code>showmenu</code> is non-zero), plus whenever the question mark (<code>?</code>) is entered. The prompt is a short version of the long menu (<code>smenu</code>). Options are single characters contained in the string <code>opts</code>}. In case of error, <code>err</code> is prompted. Defaults are handled in the usual way. The selection is returned in <code>option</code>.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>option</em>&nbsp;</td><td>pass a pointer to a single <code>char</code> variable here. On successful exit, the variable will hold the user's option in upper case.</td></tr>
    <tr><td></td><td valign=top><em>showmenu</em>&nbsp;</td><td>controls display of the long menu prompt <code>lmenu</code>. A non-zero value displays <code>lmenu</code> before doing anything else, or when the user types <code>?</code> to request for help. A zero only displays the <code>lmenu</code> when the user requests for help, unless input flag <a class="el" href="group__INF__flags.html#ga0">INF_HELP</a> is in effect, in which case the function exits and the caller is responsible for processing the help request themselves. Complicated? Yes, it is. Sorry.</td></tr>
    <tr><td></td><td valign=top><em>lmenu</em>&nbsp;</td><td>is the prompt number of the long menu to display. If <code>lmenu</code> is zero, no long menu will be displayed, no matter what the value of <code>showmenu</code> is. The long menu prompt must belong to the current message block.</td></tr>
    <tr><td></td><td valign=top><em>smenu</em>&nbsp;</td><td>is the short prompt number to display. This should give the user their options and little more besides. This prompt should belong to the current message block. It will not be displayed if the value is zero, but please don't do this as it makes things look inelegant.</td></tr>
    <tr><td></td><td valign=top><em>err</em>&nbsp;</td><td>the error prompt to display. As usual, specify zero to disable error printing. You can have an optional <code>%c</code> format specifier in the error prompt. It will be substituted by the character entered by the user.</td></tr>
    <tr><td></td><td valign=top><em>opts</em>&nbsp;</td><td>is a string of upper case characters representing the options available to the user. Leave this empty and the user will only be able to exit this part of the module by using <code>X</code> (which should work everywhere).</td></tr>
    <tr><td></td><td valign=top><em>def</em>&nbsp;</td><td>is the default user prompt (which must belong to the current prompt block). This is usually a short string added to the short menu prompt, and looks like `<code>(Enter=%c)</code>' or `<code>[%c]</code>'. The format specifier gets the value of <code>defval</code>. Use a zero to disable printing of <code>defval</code> where, for instance, the default value is printed as part of the <code>smenu</code> prompt.</td></tr>
    <tr><td></td><td valign=top><em>defval</em>&nbsp;</td><td>is the default user option (in upper case) for when the user presses <code>Enter</code>. Zero indicates no default is available and Enter reprompts.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Zero if the user bails out with <code>X</code>; one if the process was successful, in which case <code>option</code> is modified to hold the user's selection (or the default value). A value of <code>-1</code> means that <a class="el" href="group__INF__flags.html#ga0">INF_HELP</a> was set and the user pressed `<code>?</code>'. </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="ga0" doxytag="input.h::get_number" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int get_number           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">int *&nbsp;</td>
          <td class="mdname" nowrap> <em>num</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>min</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>max</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>err</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>def</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>defval</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get an integer within certain limits. 
<p>
Prompt <code>msg</code> asking for a number between <code>min</code> and <code>max</code>. Return the number in <code>num</code>. If <code>def!=0</code>, there is a default value (prompt <code>def</code> displays it) which is passed in <code>defval</code>. Prompts <code>err</code> if bad value entered.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>num</em>&nbsp;</td><td>pointer to an <code>int</code>. This is written to if a valid number is entered.</td></tr>
    <tr><td></td><td valign=top><em>msg</em>&nbsp;</td><td>is the short prompt number to display. This should give the user a brief idea of what is expected of them. This prompt should belong to the current message block. It will not be displayed if the value is zero, but please don't do this as it makes things look inelegant.</td></tr>
    <tr><td></td><td valign=top><em>min</em>&nbsp;</td><td>minimum allowed value for the number. </td></tr>
    <tr><td></td><td valign=top><em>max</em>&nbsp;</td><td>likewise, the maximum allowed value for the number.</td></tr>
    <tr><td></td><td valign=top><em>err</em>&nbsp;</td><td>the error prompt to display. Specify zero to disable error printing. You can have an optional <code>%d</code> format specifier in the error prompt. It will be substituted by the (wrong) number entered.</td></tr>
    <tr><td></td><td valign=top><em>def</em>&nbsp;</td><td>is the user prompt used when defaults are used (which must belong to the current prompt block). This is usually a short string added to the short menu prompt, and looks like `<code>(Enter=%d)</code>' or `<code>[%d]</code>'. The format specifier gets the value of <code>defval</code>. Use a zero to disable printing of <code>defval</code> where, for instance, the default value is printed by <code>msg</code>.</td></tr>
    <tr><td></td><td valign=top><em>defval</em>&nbsp;</td><td>is the default value for when the user presses <code>Enter</code>.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Zero if X entered; one is returned if the number was valid, in which case it is stored in <code>num</code>. A value of <code>-1</code> implies that <a class="el" href="group__INF__flags.html#ga0">INF_HELP</a> was set and the user entered `<code>?</code>'. </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="ga2" doxytag="input.h::get_userid" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int get_userid           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top">char *&nbsp;</td>
          <td class="mdname" nowrap> <em>uid</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>msg</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>err</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>def</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>char *&nbsp;</td>
          <td class="mdname" nowrap> <em>defval</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>online</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Get and validate a user ID. 
<p>
Prompts <code>msg</code> asking for a user ID. If the user does not exist (as checked by uidxref()), <code>err</code> is prompted (with a <code>%s</code> format specifier containing the invalid user ID. If <code>def!=0</code>, prompt <code>def</code> is displayed along with a default user ID of <code>defval</code>.<p>
The user can enter the first few characters of a user ID (three at least), and uidxref() will complete the user ID will when <code>Enter</code> is pressed. If there are more than one user IDs matching what the user entered, a short menu will be shown and the user can choose which one they meant.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>uid</em>&nbsp;</td><td>pointer to a <code>char *</code>. This is written to if a valid (or default) answer is provided. The variable will be set to the canonical form of the user ID, i.e. in full, and capitalised properly.</td></tr>
    <tr><td></td><td valign=top><em>msg</em>&nbsp;</td><td>is the short prompt number to display. This should give the user a brief idea of what is expected of them. This prompt should belong to the current message block. It will not be displayed if the value is zero, but please don't do this as it makes things look inelegant.</td></tr>
    <tr><td></td><td valign=top><em>err</em>&nbsp;</td><td>the error prompt to display. Specify zero to disable error printing.</td></tr>
    <tr><td></td><td valign=top><em>def</em>&nbsp;</td><td>is the user prompt used when defaults are used (which must belong to the current prompt block). This is usually a short string added to the short menu prompt, and looks like `<code>(Enter=%s)</code>' or `<code>[%s]</code>'. The format specifier gets the default user ID provided in <code>defval</code>. Use a zero to disable printing of <code>defval</code> where, for instance, the default value is static and included in <code>msg</code>.</td></tr>
    <tr><td></td><td valign=top><em>defval</em>&nbsp;</td><td>is the default value for when the user presses <code>Enter</code>. Specify <code>NULL</code> if there is no default.</td></tr>
    <tr><td></td><td valign=top><em>online</em>&nbsp;</td><td>if this is non-zero, the entered user ID must belong to a user who is currently on-line.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>a value of one is returned if input is valid, in which case the selected user ID can be found in <code>uid</code>. Zero is returned if the user bailed out with <code>X</code>. A value of <code>-1</code> implies that <a class="el" href="group__INF__flags.html#ga0">INF_HELP</a> was set and the user entered `<code>?</code>'. </dd></dl>
    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Thu Jul 15 16:04:03 2004 for Megistos API by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
