<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Megistos API: Declaring Global Commands</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>Declaring Global Commands</h1>Global commands are commands that work almost anywhere on the system.  
<a href="#_details">More...</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>typedef int(*&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__gcs.html#ga0">gcs_t</a> )(void)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Declaration for a GCS handler.  <a href="#ga0"></a><br><br></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__gcs.html#ga1">gcs_add</a> (<a class="el" href="group__gcs.html#ga0">gcs_t</a> gcs)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add a local-global command.  <a href="#ga1"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__gcs.html#ga2">gcs_init</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Initialise the global command services.  <a href="#ga2"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__gcs.html#ga3">gcs_handle</a> ()</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Handle GCS.  <a href="#ga3"></a><br><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Global commands are commands that work almost anywhere on the system. 
<p>
Although it's no rule of thumb, commands that start with a slash (<code>/</code>) are global commands.<p>
Megistos implements a dynamic plugin system for global commands. We used to put everything in this source file, which made things inelegant, big and ugly. Now, GCS (global command service) plugins can be compiled as dynamically loaded shared objects (DLLs in the DOS/Windows world, SOs in the UNIX world) and loaded at runtime. This way, commands are implemented by the modules that contribute them. I can't even begin to list the advantages of this scheme.<p>
To see a simple example of a global command handler, please see the Cookie module and file <code>gcs_cookie.c</code> in particular. A more complete collection is in file <code>gcs_builtin.c</code> in the main BBS library directory. <hr><h2>Typedef Documentation</h2>
<a class="anchor" name="ga0" doxytag="globalcmd.h::gcs_t" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> typedef int(* <a class="el" href="group__gcs.html#ga0">gcs_t</a>)(void)          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Declaration for a GCS handler. 
<p>
This is a pointer to a function similar to:<p>
<pre><div class="fragment">
int handler (void)
    </div></pre><p>
The handler takes no arguments. Its duties include parsing a user command that has already been input. You may use any means provided by the BBS library to this effect. I usually use the <a class="el" href="group__input.html#ga4">margc</a> and <a class="el" href="group__input.html#ga3">margv</a> technique because it's more elegant (and because I started my BBS programming days writing for the Major BBS, where this was right about the only decent way of parsing input).<p>
The handler must check to see if the user input is the command it implements. If so, it must perform any processing and return a value of 1 to the caller. If the command is not the one dealt with by the handler, the handler must return 0 to the caller.<p>
Please do not modify the user input in any way until you make sure is contains the command you service. 
<p>
Definition at line <a class="el" href="globalcmd_8h-source.html#l00117">117</a> of file <a class="el" href="globalcmd_8h-source.html">globalcmd.h</a>.    </td>
  </tr>
</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="ga1" doxytag="globalcmd.h::gcs_add" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void gcs_add           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="group__gcs.html#ga0">gcs_t</a>&nbsp;</td>
          <td class="mdname1" valign="top" nowrap> <em>gcs</em>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Add a local-global command. 
<p>
This somewhat surreal function is mostly used internally. You can use it to add your own handlers, but they will only be valid while the user is in your module. This is still useful to implement commands that work anywhere within <em>one</em> module only.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>gcs</em>&nbsp;</td><td>the global command service handler. </td></tr>
  </table>
</dl>
    </td>
  </tr>
</table>
<a class="anchor" name="ga3" doxytag="globalcmd.h::gcs_handle" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int gcs_handle           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Handle GCS. 
<p>
Executes all of the registered global command handlers in turn.<p>
<dl compact><dt><b>Returns:</b></dt><dd>If any handler returns non-zero, no more handlers are executed and a value of 1 is returned. Otherwise, zero is returned. </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="ga2" doxytag="globalcmd.h::gcs_init" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void gcs_init           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="mdname1" valign="top" nowrap>          </td>
          <td class="md" valign="top">&nbsp;)&nbsp;</td>
          <td class="md" nowrap></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Initialise the global command services. 
<p>
This scans the directory lib/gcs for GCS plugins, loads them and installs the handlers. It is called by <a class="el" href="group__toplevel.html#ga7">mod_init()</a> when specified with <a class="el" href="group__INI__flags.html#ga9">INI_GLOBCMD</a> (or, of course, <a class="el" href="group__INI__flags.html#ga12">INI_ALL</a>). No need for you to call it manually, unless you're doing something strange.     </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Thu Jul 15 16:04:03 2004 for Megistos API by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
