<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Megistos API: Security Functions</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Data&nbsp;Structures</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Data&nbsp;Fields</a> | <a class="qindex" href="globals.html">Globals</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a> | <a class="qindex" href="examples.html">Examples</a></div>
<h1>Security Functions</h1>This header implements system security.  
<a href="#_details">More...</a><table border=0 cellpadding=0 cellspacing=0>
<tr><td></td></tr>
<tr><td colspan=2><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__security.html#ga0">hassysaxs</a> (<a class="el" href="structuseracc__t.html">useracc_t</a> *user, int index)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check if a user has a certain operator command.  <a href="#ga0"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top><a class="el" href="config_8h.html#a161">bbskey_t</a> *&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__security.html#ga1">key_make</a> (<a class="el" href="config_8h.html#a161">bbskey_t</a> *userkeys, <a class="el" href="config_8h.html#a161">bbskey_t</a> *classkeys, <a class="el" href="config_8h.html#a161">bbskey_t</a> *unionkeys)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Unites user and class keyrings.  <a href="#ga1"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__security.html#ga2">key_exists</a> (<a class="el" href="config_8h.html#a161">bbskey_t</a> *keys, int key)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check for a key in a key array.  <a href="#ga2"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>int&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__security.html#ga3">key_owns</a> (<a class="el" href="structuseracc__t.html">useracc_t</a> *user, int key)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check if a user owns a key.  <a href="#ga3"></a><br><br></td></tr>
<tr><td class="memItemLeft" nowrap align=right valign=top>void&nbsp;</td><td class="memItemRight" valign=bottom><a class="el" href="group__security.html#ga4">key_set</a> (<a class="el" href="config_8h.html#a161">bbskey_t</a> *keys, int key, int set)</td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Add or remove keys from a key array.  <a href="#ga4"></a><br><br></td></tr>
</table>
<hr><a name="_details"></a><h2>Detailed Description</h2>
This header implements system security. 
<p>
Namely, sysop privilege checking and key/lock security.<p>
Sysops have an array of flags denoting a number of different command and privileges. Most of those privileges are available within the Remote Sysop module, but they have to be checked for in other places, too.<p>
Keys are similar to sysop privileges, but are available everywhere. Keys are numerical (work is underway to establish a better, database-driven, alphanumeric key system). On a normal system (i.e. not hacked and kludged), there are 130 keys, 128 of which are available to people:<p>
<ul>
<li>0. All users implicitly have this key. It cannot be added or removed, but it can be checked for.</li></ul>
<p>
<ul>
<li>1--128. These keys can be added or removed freely.</li></ul>
<p>
<ul>
<li>129. Only the user ID `Sysop' has this key, or whatever user ID is specified in the <a class="el" href="config_8h.html#a146">SYSOP</a> macro in <code><a class="el" href="config_8h.html">config.h</a></code>. The key cannot be added to anyone and it cannot be removed from Sysop's keyring.</li></ul>
<p>
BBS features have locks on them. Each lock can only be unlocked by one, specified key. A user needs to possess this key in order to access locked features.<p>
There are two sources of keys for users: their class keyring, and their own, personal keyring. The class keyring is a set of keys granted to an entire user class. Belonging to the class implies ownership of those keys. The personal keyring is the obvious: a keyring that only the user possesses. Operators can grant keys to individuals in addition to the keys their classes provide. <hr><h2>Function Documentation</h2>
<a class="anchor" name="ga0" doxytag="security.h::hassysaxs" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int hassysaxs           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structuseracc__t.html">useracc_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>user</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>index</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Check if a user has a certain operator command. 
<p>
This function checks a user account record for the existence of a specified operator privilege or command.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>user</em>&nbsp;</td><td>Pointer to the account record of the user in question.</td></tr>
    <tr><td></td><td valign=top><em>index</em>&nbsp;</td><td>The number of the privilege or operator command in question. This is one of the <code>USY_x</code> constants.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Zero if the user lacks the privilege or command, non-zero if they have it. </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="ga2" doxytag="security.h::key_exists" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int key_exists           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="config_8h.html#a161">bbskey_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>keys</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>key</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Check for a key in a key array. 
<p>
Examines the given key array for ownership of the specified key. Two keys are handled specially: key 0 is the `non-key'. All users implicitly have this one. Key 129 is the Sysop key. Only user `Sysop' (or whatever the value of the macro <a class="el" href="config_8h.html#a146">SYSOP</a> is) has this key. Not even users with the master key (usually 128, but can be changed at will) can unlock features locked with the Sysop key. All other keys are explicitly specified in the key array.<p>
If you need to check a user for ownership of a key, this isn't the right function. You need <a class="el" href="group__security.html#ga3">key_owns()</a>.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>keys</em>&nbsp;</td><td>A key array to test for key ownership.</td></tr>
  </table>
</dl>
key Key number to check.<p>
<dl compact><dt><b>Returns:</b></dt><dd>Zero if the key array does not contain the key; non-zero if it does.</dd></dl>
<dl compact><dt><b>See also:</b></dt><dd><a class="el" href="group__security.html#ga3">key_owns()</a>. </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="ga1" doxytag="security.h::key_make" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> <a class="el" href="config_8h.html#a161">bbskey_t</a>* key_make           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="config_8h.html#a161">bbskey_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>userkeys</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="config_8h.html#a161">bbskey_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>classkeys</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap><a class="el" href="config_8h.html#a161">bbskey_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>unionkeys</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Unites user and class keyrings. 
<p>
This function combines user and class keys to form the complete set of keys that a user has. A user has a key if it's contained in the keyring of the user's class, or if the user has been given this key on an individual basis.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>userkeys</em>&nbsp;</td><td>a pointer to the user's keyring array.</td></tr>
    <tr><td></td><td valign=top><em>classkeys</em>&nbsp;</td><td>a pointer to the user's class' keyring array.</td></tr>
    <tr><td></td><td valign=top><em>unionkeys</em>&nbsp;</td><td>a pointer to a keyring array that will be filled in with tue union of the two keyrings. This is effectively the return value of the function.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>The function returns <code>unionkeys</code> for no particular reason. </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="ga3" doxytag="security.h::key_owns" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> int key_owns           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="structuseracc__t.html">useracc_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>user</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>key</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Check if a user owns a key. 
<p>
Checks if a user owns a key, taking into account the Master Key privilege and the user's class keyring. This is the function to use if you need to check a user for ownership of a key.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>user</em>&nbsp;</td><td>Pointer to the user's account structure.</td></tr>
    <tr><td></td><td valign=top><em>key</em>&nbsp;</td><td>Number of the key to check for.</td></tr>
  </table>
</dl>
<dl compact><dt><b>Returns:</b></dt><dd>Zero if the user does not have the key; non-zero if they do. </dd></dl>
    </td>
  </tr>
</table>
<a class="anchor" name="ga4" doxytag="security.h::key_set" ></a><p>
<table class="mdTable" width="100%" cellpadding="2" cellspacing="0">
  <tr>
    <td class="mdRow">
      <table cellpadding="0" cellspacing="0" border="0">
        <tr>
          <td class="md" nowrap valign="top"> void key_set           </td>
          <td class="md" valign="top">(&nbsp;</td>
          <td class="md" nowrap valign="top"><a class="el" href="config_8h.html#a161">bbskey_t</a> *&nbsp;</td>
          <td class="mdname" nowrap> <em>keys</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>key</em>, </td>
        </tr>
        <tr>
          <td class="md" nowrap align="right"></td>
          <td></td>
          <td class="md" nowrap>int&nbsp;</td>
          <td class="mdname" nowrap> <em>set</em></td>
        </tr>
        <tr>
          <td></td>
          <td class="md">)&nbsp;</td>
          <td class="md" colspan="2"></td>
        </tr>
      </table>
    </td>
  </tr>
</table>
<table cellspacing=5 cellpadding=0 border=0>
  <tr>
    <td>
      &nbsp;
    </td>
    <td>

<p>
Add or remove keys from a key array. 
<p>
Sets or clears keys within the specified key array.<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td></td><td valign=top><em>keys</em>&nbsp;</td><td>The key array to modify.</td></tr>
    <tr><td></td><td valign=top><em>key</em>&nbsp;</td><td>The key to add or remove. Key 0 cannot be added or removed, it is implicitly present in all keyrings. Key 129 cannot be added or removed, it is implicitly absent from all keyrings (won't even fit, on a normal system). Specifying an invalid key number causes no error, but no operation either.</td></tr>
    <tr><td></td><td valign=top><em>set</em>&nbsp;</td><td>If non-zero, the specified key will be added to the keyring. If zero, the key will be removed. </td></tr>
  </table>
</dl>
    </td>
  </tr>
</table>
<hr size="1"><address style="align: right;"><small>Generated on Thu Jul 15 16:04:03 2004 for Megistos API by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 ></a> 1.3.7 </small></address>
</body>
</html>
